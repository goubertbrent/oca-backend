<mat-progress-bar *ngIf="statisticsLoading$ | async" mode="indeterminate"></mat-progress-bar>
<form *ngIf="statisticsList$ | async as list" [formGroup]="formGroup">
  <div class="top-row">
    <div class="total-list">
      <div *ngFor="let total of totals$ | async" class="total-item">
        <mat-icon [style.color]="total.color">{{ total.icon }}</mat-icon>
        <span class="total-label">{{ total.label | translate }}</span>
        <span class="total-amount">{{ total.amount }}</span>
      </div>
    </div>
    <div class="date-selectors">
      <mat-form-field>
        <mat-label>{{ 'oca.year' | translate }}</mat-label>
        <mat-select [formControl]="yearControl" multiple>
          <oca-select-all-option [control]="yearControl"
                                 [text]="'oca.All' | translate"
                                 [values]="yearValues$ | async"></oca-select-all-option>
          <mat-option *ngFor="let result of list.results" [value]="result.year">
            {{ result.year }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-label>{{ 'oca.month' | translate }}</mat-label>
        <mat-select [formControl]="monthControl" multiple>
          <oca-select-all-option [control]="monthControl"
                                 [text]="'oca.All' | translate"
                                 [values]="monthValues"></oca-select-all-option>
          <mat-option *ngFor="let month of months" [value]="month.value">
            {{ month.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
  <agm-map *ngIf="showMap$ | async"
           [fitBounds]="true"
           [scrollwheel]="null"
           (mapReady)="onMapReady($event)"
           class="incidents-map"
           gestureHandling="cooperative">
    <agm-marker *ngFor="let marker of mapMarkers$ | async"
                [agmFitBounds]="true"
                [latitude]="marker.lat"
                [iconUrl]="marker.markerIcon"
                [longitude]="marker.lon">
      <agm-info-window>
        <p>{{ marker.status }}</p>
        <p>{{ marker.tags }}</p>
      </agm-info-window>
    </agm-marker>
  </agm-map>
  <ng-container *ngIf="categoryCharts$ | async as charts">
    <h4 *ngIf="charts.length">{{ 'oca.total_per_category' | translate }}</h4>
    <oca-paginated-charts [charts]="charts"></oca-paginated-charts>
    <h4 *ngIf="(filterableTagList$ | async).length">{{ 'oca.total_per_subcategory' | translate }}</h4>
  </ng-container>
  <mat-chip-list [formControl]="tagControl" class="filter-list" multiple>
    <mat-chip (click)="toggleSelectedTag(tag)"
              *ngFor="let tag of filterableTagList$ | async"
              [value]="tag.id">{{ tag.name }}</mat-chip>
  </mat-chip-list>
  <oca-paginated-charts [charts]="filteredCharts$ | async"></oca-paginated-charts>
</form>
